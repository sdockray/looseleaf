<html>
<head>
<title>BOOKS WITHOUT COVERS</title>
<script src="js/spine.js"></script>
<style>
body {
  padding: 0;
  margin: 0;
  overflow-x: hidden;
}
.focus {
  position: absolute;
  z-index: 50;
  border: 1px solid red;
  width: 700px;
  height: 350px;
  overflow: auto;
  overflow-x: hidden;
}
.focus .pageframe img {
  width: 700px;
}
.on {
  position: absolute;
  width: 50px;
  height: 72px;
  border: 1px dotted red;
}
.pageframe {
  background-color: white;
  width: 700px;
  height: 1000px;
}
.line {
  background-color: white;
  height: 72px;
}
</style>
</head>
<body>
<script>

var texts = [
    ['5d4d6efc38ae5c5c05111987095a43e2', 264]
].map(function(x) {
        return new Text(x[0], x[1]);
    });
var line = new Line(texts);
var flow = new Flow(line, document.body.clientWidth);
document.body.appendChild(flow.$el);

var focus = new Focus(line);
document.body.appendChild(focus.$el);

var $on = document.createElement("div");
$on.className = "on";
document.body.appendChild($on);

flow.onclick = function(p) {
    focus.$el.scrollTop = p.absolute_page * fuH;
}
var auto_hash = false;
focus.onscroll = function(p) {
    var top_of_page = Math.floor(p);
    if(top_of_page != Number(window.location.hash.slice(1))) {
        auto_hash = true;
        window.location.hash = top_of_page;
    }

    var pos = flow.absPageToPos(p);
    focus.$el.style.left = (flow.width - focus.$el.clientWidth) * (pos[0] / flow.width);
    focus.$el.style.top = pos[1] + thH;

    $on.style.left = pos[0];
    $on.style.top = pos[1];
}

draw_visible(flow);

function navigate_to_hash() {
    if(!auto_hash) {
        var p = Number(window.location.hash.slice(1));
        focus.$el.scrollTop = p * fuH;
        // scroll body
        document.body.scrollTop = Math.floor(p / flow.ncols) * thH;
    }
    auto_hash = false;
}
navigate_to_hash();
window.addEventListener("hashchange", function(ev) {
    ev.preventDefault();
    navigate_to_hash()
}, false);

var scroll_queue=0;
window.onscroll = function() {
    scroll_queue += 1;
    window.setTimeout(function() {
        scroll_queue -= 1;
        if(scroll_queue === 0) {
            console.log("draw visible!");
            draw_visible(flow);
        }
    }, 50);
};

</script>
</body>
</html>
